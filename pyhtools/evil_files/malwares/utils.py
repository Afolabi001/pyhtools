from platform import system
from sys import platform


import ctypes
import smtplib
import requests


def send_mail(email: str, receiver_mail: list[str], password: str, message: str, smtp_server: str = 'smtp.gmail.com', smtp_port: int = 587, supress_exceptions: bool = True) -> bool:
    '''
    sends mail to specific address/addresses.
    '''
    try:
        server = smtplib.SMTP(smtp_server, smtp_port)
        server.starttls()
        server.login(email, password)
        server.sendmail(email, receiver_mail, message)
        server.quit()
        return True
    except smtplib.SMTPException as e:
        if not supress_exceptions:
            print('[-] Exception : ', e)
        return False


def download(url: str) -> bool:
    '''
    description: download and save file from the url.
    params: url
    returns: bool
    '''
    try:
        response = requests.get(url)
        file_name = url.split('/')[-1]
        with open(file_name, 'wb') as file:
            file.write(response.content)
        return True

    except Exception as e:
        print('[-] Exception : ', e)
        return False


def is_admin() -> bool:
    is_admn = False
    match system():
        case 'Windows':
            is_admn = ctypes.windll.shell32.IsUserAnAdmin() != 0
        case _:
            from os import getuid
            is_admn = getuid() == 0

    return is_admn


def check_os() -> str:
    if platform in ['linux', 'linux2']:
        return 'linux'
    elif platform == 'darwin':
        return 'macos'
    elif platform == 'win32':
        return 'windows'
    else:
        return 'unknown'
